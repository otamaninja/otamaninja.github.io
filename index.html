<html>

  <head>
    <title>Sound Slider</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  </head>

  <body>
    <script>
      class SoundController {
          constructor() {
              this.context = new AudioContext();
              this.snds = [];
              this.gainNode = null;
              this.selectableWaveformTypes = ["sine", "square", "sawtooth", "triangle"];
              this.waveformType = "sine"; // åˆæœŸå€¤ã¯ã‚µã‚¤ãƒ³æ³¢
              this.baseFrequency = 100; // æœ€ä½å‘¨æ³¢æ•°ã®åˆæœŸå€¤
              this.frequencyStep = Math.max(Math.floor(document.body.clientHeight / 200) * 100, 100); // ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã«å‘¨æ³¢æ•°ã‚’å‹•ã‹ã™å¹…
              this.createUI();
              this.createFrequencyDisplay();
          }

          getNoteAndDremi(frequency) {
              // éŸ³éšã¨å¯¾å¿œã™ã‚‹å‘¨æ³¢æ•°ã€ãƒ‰ãƒ¬ãƒŸã®é…åˆ—
              const notes = [{ frequency: 90, note: "-", doremi: "-" }, { frequency: 130.81, note: "C3", doremi: "ãƒ‰" }, { frequency: 138.59, note: "Câ™¯3 / Dâ™­3", doremi: "ãƒ¬â™­" }, { frequency: 146.83, note: "D3", doremi: "ãƒ¬" }, { frequency: 155.56, note: "Dâ™¯3 / Eâ™­3", doremi: "ãƒŸâ™­" }, { frequency: 164.81, note: "E3", doremi: "ãƒŸ" }, { frequency: 174.61, note: "F3", doremi: "ãƒ•ã‚¡" }, { frequency: 185.00, note: "Fâ™¯3 / Gâ™­3", doremi: "ã‚½â™­" }, { frequency: 196.00, note: "G3", doremi: "ã‚½" }, { frequency: 207.65, note: "Gâ™¯3 / Aâ™­3", doremi: "ãƒ©â™­" }, { frequency: 220.00, note: "A3", doremi: "ãƒ©" }, { frequency: 233.08, note: "Aâ™¯3 / Bâ™­3", doremi: "ã‚·â™­" }, { frequency: 246.94, note: "B3", doremi: "ã‚·" }, { frequency: 261.63, note: "C4", doremi: "ãƒ‰" }, { frequency: 277.18, note: "Câ™¯4 / Dâ™­4", doremi: "ãƒ¬â™­" }, { frequency: 293.66, note: "D4", doremi: "ãƒ¬" }, { frequency: 311.13, note: "Dâ™¯4 / Eâ™­4", doremi: "ãƒŸâ™­" }, { frequency: 329.63, note: "E4", doremi: "ãƒŸ" }, { frequency: 349.23, note: "F4", doremi: "ãƒ•ã‚¡" }, { frequency: 369.99, note: "Fâ™¯4 / Gâ™­4", doremi: "ã‚½â™­" }, { frequency: 392.00, note: "G4", doremi: "ã‚½" }, { frequency: 415.30, note: "Gâ™¯4 / Aâ™­4", doremi: "ãƒ©â™­" }, { frequency: 440.00, note: "A4", doremi: "ãƒ©" }, { frequency: 466.16, note: "Aâ™¯4 / Bâ™­4", doremi: "ã‚·â™­" }, { frequency: 493.88, note: "B4", doremi: "ã‚·" }, { frequency: 523.25, note: "C5", doremi: "ãƒ‰" }, { frequency: 554.37, note: "Câ™¯5 / Dâ™­5", doremi: "ãƒ¬â™­" }, { frequency: 587.33, note: "D5", doremi: "ãƒ¬" }, { frequency: 622.25, note: "Dâ™¯5 / Eâ™­5", doremi: "ãƒŸâ™­" }, { frequency: 659.26, note: "E5", doremi: "ãƒŸ" }, { frequency: 698.46, note: "F5", doremi: "ãƒ•ã‚¡" }, { frequency: 739.99, note: "Fâ™¯5 / Gâ™­5", doremi: "ã‚½â™­" }, { frequency: 783.99, note: "G5", doremi: "ã‚½" }, { frequency: 830.61, note: "Gâ™¯5 / Aâ™­5", doremi: "ãƒ©â™­" }, { frequency: 880.00, note: "A5", doremi: "ãƒ©" }, { frequency: 932.33, note: "Aâ™¯5 / Bâ™­5", doremi: "ã‚·â™­" }, { frequency: 987.77, note: "B5", doremi: "ã‚·" }, { frequency: 1046.50, note: "C6", doremi: "ãƒ‰" }, { frequency: 1108.73, note: "Câ™¯6 / Dâ™­6", doremi: "ãƒ¬â™­" }, { frequency: 1174.66, note: "D6", doremi: "ãƒ¬" }, { frequency: 1244.51, note: "Dâ™¯6 / Eâ™­6", doremi: "ãƒŸâ™­" }, { frequency: 1318.51, note: "E6", doremi: "ãƒŸ" }, { frequency: 1396.91, note: "F6", doremi: "ãƒ•ã‚¡" }, { frequency: 1479.98, note: "Fâ™¯6 / Gâ™­6", doremi: "ã‚½â™­" }, { frequency: 1567.98, note: "G6", doremi: "ã‚½" }, { frequency: 1661.22, note: "Gâ™¯6 / Aâ™­6", doremi: "ãƒ©â™­" }, { frequency: 1760.00, note: "A6", doremi: "ãƒ©" }, { frequency: 1864.66, note: "Aâ™¯6 / Bâ™­6", doremi: "ã‚·â™­" }, { frequency: 1975.53, note: "B6", doremi: "ã‚·" }, { frequency: 2093.00, note: "C7", doremi: "ãƒ‰" }, { frequency: 2217.46, note: "Câ™¯7 / Dâ™­7", doremi: "ãƒ¬â™­" }, { frequency: 2349.32, note: "D7", doremi: "ãƒ¬" }, { frequency: 2489.02, note: "Dâ™¯7 / Eâ™­7", doremi: "ãƒŸâ™­" }, { frequency: 2637.02, note: "E7", doremi: "ãƒŸ" }, { frequency: 2793.83, note: "F7", doremi: "ãƒ•ã‚¡" }, { frequency: 2959.96, note: "Fâ™¯7 / Gâ™­7", doremi: "ã‚½â™­" }, { frequency: 3135.96, note: "G7", doremi: "ã‚½" }, { frequency: 3322.44, note: "Gâ™¯7 / Aâ™­7", doremi: "ãƒ©â™­" }, { frequency: 3520.00, note: "A7", doremi: "ãƒ©" }, { frequency: 3729.31, note: "Aâ™¯7 / Bâ™­7", doremi: "ã‚·â™­" }, { frequency: 3951.07, note: "B7", doremi: "ã‚·" }, { frequency: 4100, note: "-", doremi: "-" }];
              // å‘¨æ³¢æ•°å·®ã®æœ€å°å€¤ã‚’è¨ˆç®—ã—ã¦æœ€ã‚‚è¿‘ã„éŸ³éšã‚’è¦‹ã¤ã‘ã‚‹
              let closestNote = notes.reduce((prev, curr) =>
                  Math.abs(curr.frequency - frequency) < Math.abs(prev.frequency - frequency) ? curr : prev
              );

              return `${closestNote.note} (${closestNote.doremi})`;
          }

          // éŸ³ã‚’å†ç”Ÿ
          playSin(freq) {
              if (this.snd) return;
              this.snd = this.context.createOscillator();
              this.snd.type = this.waveformType;
              this.snd.frequency.value = freq;

              this.gainNode = this.context.createGain();
              this.gainNode.gain.setValueAtTime(1, this.context.currentTime);
              this.gainNode.connect(this.context.destination);

              this.snd.connect(this.gainNode);
              this.snd.start();
          }

          // éŸ³ã‚’åœæ­¢
          stopSin() {
              if (this.snd && this.context) {
                  this.gainNode.gain.setValueAtTime(1, this.context.currentTime);
                  this.gainNode.gain.linearRampToValueAtTime(0, this.context.currentTime + 0.3);
                  const removedSnd = this.snd;
                  this.snd = null;
                  setTimeout(() => {
                      removedSnd.stop();
                      removedSnd.disconnect();
                  }, 300);
              }
          }


          // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’ä½œæˆã™ã‚‹é–¢æ•°
          createOverlay() {
              const overlay = document.createElement('div');
              overlay.innerText = `
          å·¦å´ã®é»’ã„ãƒãƒ¼ã‚’
          - ã‚¿ãƒƒãƒã€
          - ã‚¹ãƒ©ã‚¤ãƒ‰
          ã™ã‚‹ã¨æ¼”å¥ã§ãã¾ã™ã€‚

          ğ‘»ğ’ğ’–ğ’„ğ’‰ ğ‘»ğ’ ğ‘ºğ’•ğ’‚ğ’“ğ’•`;

              // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’JavaScriptã§è¨­å®š
              overlay.style.position = 'fixed';
              overlay.style.boxSizing = 'border-box';
              overlay.style.top = '0';
              overlay.style.left = '0';
              overlay.style.width = '100%';
              overlay.style.height = '100%';
              overlay.style.padding = '2em';
              overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
              overlay.style.display = 'flex';
              overlay.style.alignItems = 'center';
              overlay.style.justifyContent = 'center';
              overlay.style.color = 'white';
              overlay.style.fontSize = '24px';
              overlay.style.transition = 'opacity 1s ease-out'; // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã®ãŸã‚ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³
              overlay.style.opacity = '1'; // åˆæœŸçŠ¶æ…‹ã§ã¯è¡¨ç¤º
              overlay.style.zIndex = '1000';

              // ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã§ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
              overlay.addEventListener('click', () => {
                  overlay.style.opacity = '0'; // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
                  setTimeout(() => {
                      overlay.remove(); // 1ç§’å¾Œã«è¦ç´ ã‚’å‰Šé™¤
                  }, 1000); // 1ç§’=1000ãƒŸãƒªç§’
              });

              document.body.appendChild(overlay); // bodyã«è¿½åŠ 
          }
          // å‘¨æ³¢æ•°è¡¨ç¤ºã®ãŸã‚ã®UIä½œæˆ
          createFrequencyDisplay() {
              this.freqDisplay = document.createElement('div');
              this.freqDisplay.style.position = "absolute";
              this.freqDisplay.style.color = "#FFF";
              this.freqDisplay.style.fontSize = "1.5em";
              this.freqDisplay.style.lineHeight = "2em";
              this.freqDisplay.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
              this.freqDisplay.style.padding = "0.5em";
              this.freqDisplay.style.borderRadius = "0.5em";
              this.freqDisplay.style.transform = "translateY(-1.5em)"
              this.freqDisplay.style.visibility = "hidden";  // æœ€åˆã¯éè¡¨ç¤º
              document.body.appendChild(this.freqDisplay);
          }

          // UIã‚’ä½œæˆ
          createUI() {
              // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–
              document.body.style.overflow = "hidden";

              // éŸ³ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
              const soundSlider = document.createElement('div');
              soundSlider.style.width = "3.5em";
              soundSlider.style.height = "100vh";
              soundSlider.style.marginLeft = "2em";
              soundSlider.style.background = "#333";



              soundSlider.addEventListener("touchstart", (e) => {
                  const y = e.touches[0].pageY;
                  const height = document.body.clientHeight;
                  const freq = this.baseFrequency + (height - y); // åè»¢
                  this.playSin(freq);
                  this.updateFrequencyDisplay(e.touches[0].pageX, e.touches[0].pageY, freq);
              });

              soundSlider.addEventListener("touchmove", (e) => {
                  const y = e.touches[0].pageY;
                  const height = document.body.clientHeight;
                  if (this.snd) {
                      const freq = this.baseFrequency + (height - y); // åè»¢
                      this.snd.frequency.value = freq;
                      this.updateFrequencyDisplay(e.touches[0].pageX, e.touches[0].pageY, freq);
                  }
              });
              /*
                soundSlider.addEventListener("touchstart", (e) => {
                const y = e.touches[0].pageY;
                this.playSin(this.baseFrequency + y);
                this.updateFrequencyDisplay(e.touches[0].pageX, e.touches[0].pageY, this.baseFrequency + y);
                });

                soundSlider.addEventListener("touchmove", (e) => {
                const y = e.touches[0].pageY;
                if (this.snd) {
                this.snd.frequency.value = this.baseFrequency + y;
                this.updateFrequencyDisplay(e.touches[0].pageX, e.touches[0].pageY, this.baseFrequency + y);
                }
                });
              */
              soundSlider.addEventListener("touchend", () => {
                  this.stopSin();
                  this.freqDisplay.style.visibility = "hidden";  // ã‚¿ãƒƒãƒçµ‚äº†æ™‚ã«éè¡¨ç¤º
              });

              document.body.append(soundSlider);

              // æœ€ä½å‘¨æ³¢æ•°ã‚’èª¿æ•´ã™ã‚‹UIã‚’ç”»é¢å³å´ã«é…ç½®
              const controlContainer = document.createElement('div');
              controlContainer.style.position = "fixed";
              controlContainer.style.top = "50%";
              controlContainer.style.right = "1em";
              controlContainer.style.transform = "translateY(-50%)";
              controlContainer.style.display = "flex";
              controlContainer.style.flexDirection = "column";
              controlContainer.style.alignItems = "center";
              controlContainer.style.backgroundColor = "#333";
              controlContainer.style.color = "#FFF";
              controlContainer.style.padding = "1em";
              controlContainer.style.borderRadius = "1em";

              // æœ€ä½å‘¨æ³¢æ•°ã®è¡¨ç¤ºã¨å…¥åŠ›æ¬„
              const freqLabel = document.createElement('label');
              freqLabel.innerText = "Base Freq ";
              controlContainer.appendChild(freqLabel);

              const freqInput = document.createElement('input');
              freqInput.type = "number";
              freqInput.value = this.baseFrequency;
              freqInput.style.width = "6em";
              freqInput.style.padding = "0.5em";
              freqInput.style.margin = "0.5em";
              freqInput.style.fontSize = "1.2em";
              freqInput.style.borderRadius = "0.5em";
              freqInput.style.border = "none";
              freqInput.style.textAlign = "center";
              freqInput.addEventListener("input", (e) => {
                  this.baseFrequency = parseInt(e.target.value) || 200;
              });
              controlContainer.appendChild(freqInput);

              // æ³¢å½¢é¸æŠç”¨ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼
              const waveformLabel = document.createElement('label');
              waveformLabel.innerText = "Waveform ";
              controlContainer.appendChild(waveformLabel);

              const waveformSelect = document.createElement('select');
              this.selectableWaveformTypes.forEach(type => {
                  const option = document.createElement('option');
                  option.value = type;
                  option.text = type.charAt(0).toUpperCase() + type.slice(1);
                  waveformSelect.appendChild(option);
              });
              waveformSelect.style.width = "6em";
              waveformSelect.style.padding = "0.5em";
              waveformSelect.style.margin = "0.5em";
              waveformSelect.style.fontSize = "1.2em";
              waveformSelect.style.borderRadius = "0.5em";
              waveformSelect.addEventListener("change", (e) => {
                  this.waveformType = e.target.value;  // é¸æŠã—ãŸæ³¢å½¢ã‚’é©ç”¨
              });
              controlContainer.appendChild(waveformSelect);

              // å¢—æ¸›ãƒœã‚¿ãƒ³Wrapper
              const buttonContainer = document.createElement('div');
              buttonContainer.style.display = "flex";
              buttonContainer.style.flexDirection = "column";
              buttonContainer.style.gap = "1em";
              buttonContainer.style.marginTop = "1em";

              // ãƒã‚¤ãƒŠã‚¹ãƒœã‚¿ãƒ³
              const decreaseButton = document.createElement('button');
              decreaseButton.innerText = "âˆ’";
              decreaseButton.style.padding = ".2em 1em";
              decreaseButton.style.fontSize = "3em";
              decreaseButton.style.backgroundColor = "#FF6347";
              decreaseButton.style.color = "#FFF";
              decreaseButton.style.border = "none";
              decreaseButton.style.borderRadius = "0.5em";
              decreaseButton.style.cursor = "pointer";
              decreaseButton.style.transition = "all 0.3s ease";
              decreaseButton.addEventListener("click", () => {
                  this.baseFrequency = Math.max(100, this.baseFrequency - this.frequencyStep);
                  freqInput.value = this.baseFrequency;
              });
              decreaseButton.addEventListener("mouseenter", () => {
                  decreaseButton.style.backgroundColor = "#e55347"; // ãƒ›ãƒãƒ¼æ™‚ã®è‰²å¤‰æ›´
              });
              decreaseButton.addEventListener("mouseleave", () => {
                  decreaseButton.style.backgroundColor = "#FF6347"; // é€šå¸¸æ™‚ã«æˆ»ã™
              });
              buttonContainer.appendChild(decreaseButton);

              // ãƒ—ãƒ©ã‚¹ãƒœã‚¿ãƒ³
              const increaseButton = document.createElement('button');
              increaseButton.innerText = "+";
              increaseButton.style.padding = ".2em 1em";
              increaseButton.style.fontSize = "3em";
              increaseButton.style.backgroundColor = "#4CAF50";
              increaseButton.style.color = "#FFF";
              increaseButton.style.border = "none";
              increaseButton.style.borderRadius = "0.5em";
              increaseButton.style.cursor = "pointer";
              increaseButton.style.transition = "all 0.3s ease";
              increaseButton.addEventListener("click", () => {
                  this.baseFrequency += this.frequencyStep;
                  freqInput.value = this.baseFrequency;
              });
              increaseButton.addEventListener("mouseenter", () => {
                  increaseButton.style.backgroundColor = "#45a049"; // ãƒ›ãƒãƒ¼æ™‚ã®è‰²å¤‰æ›´
              });
              increaseButton.addEventListener("mouseleave", () => {
                  increaseButton.style.backgroundColor = "#4CAF50"; // é€šå¸¸æ™‚ã«æˆ»ã™
              });
              buttonContainer.appendChild(increaseButton);

              controlContainer.appendChild(buttonContainer);
              document.body.append(controlContainer);

              // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º
              document.addEventListener('DOMContentLoaded', this.createOverlay);
          }

          // å‘¨æ³¢æ•°è¡¨ç¤ºã‚’æ›´æ–°
          updateFrequencyDisplay(x, y, freq) {
              this.freqDisplay.style.left = `6rem`;  // xä½ç½®ã¯SoundBarã®å³å´
              this.freqDisplay.style.top = `${y}px`;        // yä½ç½®ã¯æŒ‡ã®ä½ç½®
              this.freqDisplay.innerText = `Freq: ${freq.toFixed(0)} Hz ${this.getNoteAndDremi(freq)}`;
              this.freqDisplay.style.visibility = "visible"; // è¡¨ç¤º
          }
      }

      // body åˆæœŸåŒ–
      document.body.style.background = "#CCC";
      document.body.style.touchAction = "pan-x pan-y";
      document.body.style.width = "100vw";
      document.body.style.height = "100vh";
      document.body.style.transition = "font-size 0.3s ease-out";
      const adjustFontSize = () => {
          const isBodyPortrait = document.body.clientHeight > document.body.clientWidth;
          document.body.style.fontSize = isBodyPortrait ? "4vw" : "3vh";
          document.body.style.margin = document.body.style.padding = "0";
      }
      adjustFontSize();
      window.addEventListener("orientationchange", () => { setTimeout(adjustFontSize, 100) });

      // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦å®Ÿè¡Œ
      const soundController = new SoundController();
    </script>
  </body>

</html>
